---
declare global {
  interface Window {
    showHouseConfirmPopup?: () => void;
    confirmHouseSubmission?: () => void;
  }
}
---

<!-- House Confirm Popup Overlay -->
<div
  id="view-house-confirm-popup"
  class="fixed inset-0 z-50 bg-[rgba(0,0,0,0.7)] translate-x-[9px] items-center justify-center transition-opacity duration-200 w-full min-h-[500px] hidden"
>
  <!-- House Confirm Popup Wrapper -->
  <div class="relative w-full max-w-md px-5">
    <!-- Pink trapezoids -->
    <div class="absolute left-5 top-1/2 -translate-y-1/2 w-full h-full bg-[#FF1493] z-10 trapezoid-l-1"></div>
    <div class="absolute right-5 top-1/2 -translate-y-1/2 w-full h-full bg-[#FF1493] z-10 trapezoid-r-1"></div>

    <!-- Border -->
    <div class="cut-houses-1 bg-[#8A2BE4] p-[1.5px] relative">
      <!-- Content -->
      <div
        class="relative cut-houses-1 bg-[#2B2D42BF] px-5 py-8 flex flex-col items-center min-h-[340px] h-fit"
        id="view-house-confirm-popup-content"
      >
        <!-- Header -->
        <p class="text-white text-3xl font-semibold">ยืนยันการเลือกบ้าน</p>

        <!-- Text -->
        <div class="flex flex-col items-center gap-6 pt-5 justify-center">
          <img src="/images/rpkm/noti-icon.svg" width="72" height="72"/>
          <p class="text-center text-sm">*เมื่อยืนยันแล้วจะไม่สามารถแก้ไขรายการของบ้าน<br/>และจะไม่สามารถจับคู่กับเพื่อนได้อีก</p>
        </div>

        <!-- Buttons -->
        <div class="flex gap-5 pt-7">
          <button
            id="btn-cancel-house-popup"
            class="cut-edge-all bg-[linear-gradient(90deg,_#FF1493_0%,_#2B2D42_100%)] cursor-pointer flex justify-center items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
            type="button"
            style={`width: 130px; height: 48px;`}
          >
            <p class="text-xl text-white font-medium">ยกเลิก</p>
          </button>
           <button
            id="btn-confirm-house-popup"
            class="cut-edge-all bg-[linear-gradient(90deg,_#00ffff_0%,_#2B2D42_100%)] cursor-pointer flex justify-center items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
            type="button"
            style={`width: 130px; height: 48px;`}
          >
            <p class="text-xl text-white font-medium">ยืนยัน</p>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- House Success Popup Overlay -->
<div
  id="view-house-success-popup"
  class="fixed inset-0 z-50 bg-[rgba(0,0,0,0.7)] translate-x-[9px] items-center justify-center transition-opacity duration-200 w-full hidden"
>
  <!-- Popup Success Wrapper -->
  <div class="relative w-full max-w-md px-5">
    <!-- Pink trapezoids -->
    <div class="absolute left-5 top-1/2 -translate-y-1/2 w-full h-full bg-[#FF1493] z-10 trapezoid-l-1"></div>
    <div class="absolute right-5 top-1/2 -translate-y-1/2 w-full h-full bg-[#FF1493] z-10 trapezoid-r-1"></div>

    <!-- Border -->
    <div class="cut-houses-1 bg-[#8A2BE4] p-[1.5px] relative">
      <!-- Content -->
      <div 
        class="relative cut-houses-1 bg-[#2B2D42BF] px-5 pt-8 pb-8 flex flex-col items-center min-h-[340px] h-fit" 
        id="view-house-success-popup-content">
        
        <!-- Check -->
        <img src="/images/rpkm/check-icon.svg" class="mt-10 border-4 rounded-full border-[#FF1493]" width="80" height="80" />

        <!-- Text -->
        <p class="text-2xl text-white font-medium pt-4">เลือกบ้านสำเร็จ</p>
    </div>
  
  </div>
  <!-- X Button -->
    <button 
      class="absolute left-1/2 bg-[#8A2BE4] z-30 w-10 h-10 text-xl cut-edge-all-sm cursor-pointer text-white -translate-x-1/2 -translate-y-1/2 shadow-lg"
      id="btn-close-house-confirm-popup"
    >
      X
    </button>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const confirmPopup = document.getElementById("view-house-confirm-popup");
    const successPopup = document.getElementById("view-house-success-popup");
    const btnCancel = document.getElementById("btn-cancel-house-popup");
    const btnConfirm = document.getElementById("btn-confirm-house-popup");
    const btnClose = document.getElementById("btn-close-house-confirm-popup");

    // Show confirm popup function
    window.showHouseConfirmPopup = function() {
      confirmPopup?.classList.remove("hidden");
      confirmPopup?.classList.add("flex");
    };

    // Hide confirm popup function
    function hideConfirmPopup() {
      confirmPopup?.classList.add("hidden");
      confirmPopup?.classList.remove("flex");
    }

    // Show success popup function
    function showSuccessPopup() {
      successPopup?.classList.remove("hidden");
      successPopup?.classList.add("flex");
    }

    // Hide success popup function
    function hideSuccessPopup() {
      successPopup?.classList.add("hidden");
      successPopup?.classList.remove("flex");
    }

    // Cancel button - hide confirm popup
    btnCancel?.addEventListener("click", () => {
      hideConfirmPopup();
    });

    // Confirm button - hide confirm popup and show success popup
    btnConfirm?.addEventListener("click", () => {
      hideConfirmPopup();
      showSuccessPopup();
      
      // Trigger the actual submission in the parent component
      if (window.confirmHouseSubmission) {
        window.confirmHouseSubmission();
      }
    });

    // Close button - hide success popup
    btnClose?.addEventListener("click", () => {
      hideSuccessPopup();
    });

    // Click outside to close success popup
    successPopup?.addEventListener("click", (e) => {
      if (e.target === successPopup) {
        hideSuccessPopup();
      }
    });
  });
</script>