---
import { getProfile } from "@/lib/profileAPI";
import type { User } from "@/types/common";

import UserProfile from "../rubpuen/UserProfile";

const token = Astro.cookies.get("token")?.value;

let userProfile = null;
if (token) {
  const response = await getProfile(token);
  if (response.success && response.data) {
    userProfile = response.data.user as User;
  }
}

if (!userProfile) {
  return Astro.redirect("/login");
}
---

{userProfile && <UserProfile user={userProfile} className="profile-avatar" />}
